功能实现指南
250803

项目概述
项目名称: The Dreamer 目标用户: 中国大陆高中生，日常使用 核心目标: 通过数据分析实现学习的自由、秩序与自我掌控 开发周期: 利用AI加速，预计1-2天完成各Phase
总体架构原则
* 技术栈: SwiftUI, SwiftData, Swift Charts
* 目标SDK: iOS 26
* 架构模式: MV (Model-View)
* 代码组织: 严格按职责划分目录 (Models/, Views/, Components/, Utils/)
* 编译测试: xcodebuild -project The Dreamer.xcodeproj -scheme The Dreamer -destination platform=iOS Simulator,name=iPhone 16 Pro clean build

Phase 1: 核心修复与逻辑完善 (高优先级)
目标: 解决编辑缺失、引入考试组与自动起名，修复Chart问题 预计时间: 1-2天

- [x] 任务1: 引入全面编辑功能
负责人: @程序员 描述: 在现有视图中添加编辑入口，支持修改考试名称、分数值等字段
实现步骤:
1. 修复科目选择菜单顺序问题
    * 检查 AddDataView.swift 中科目选择Menu的数据源
    * 确保使用 Subject.orderIndex 排序，与 ManageSubjectsView 一致
2. 在 ExamDetailView 添加编辑功能
    * 添加 "编辑" 按钮到导航栏
    * 创建编辑模式状态变量 @State private var isEditing = false
    * 编辑模式下显示可编辑的TextField替代Text
    * 添加保存/取消按钮
3. 在 AddDataView 添加inline编辑
    * 为分数输入框添加编辑后保存逻辑
    * 确保数据验证和错误处理
验收标准:
* 用户可编辑考试名称、分数、日期等字段
* 科目选择菜单顺序正确
* 编译通过，无运行时错误
- [x] 任务2: 设计并实现考试组模型与日期表
负责人: @架构师 描述: 在Models.swift中添加ExamGroup模型，支持多张日期表绑定
实现步骤:
1. 添加 ExamGroup 模型@Model
2. class ExamGroup {
3.     var name: String
4.     var semester: String
5.     var createdDate: Date
6. 
7. // 关联的考试
8.     @Relationship(deleteRule: .cascade, inverse: \Exam.examGroup)
9.     var exams: [Exam] = []
10. 
11. // 关联的日期表
12.     @Relationship(deleteRule: .cascade, inverse: \ExamSchedule.examGroup)
13.     var schedules: [ExamSchedule] = []
14. 
15. init(name: String, semester: String) {
16.         self.name = name
17.         self.semester = semester
18.         self.createdDate = Date()
19.     }
20. }
21. 
22. 添加 ExamSchedule 模型 (日期表)@Model
23. class ExamSchedule {
24.     var date: Date
25.     var dayNumber: Int // 第几天
26.     var subjects: [String] // 当天考试科目列表
27. 
28. // 关联的考试组
29.     var examGroup: ExamGroup?
30. 
31. init(date: Date, dayNumber: Int, subjects: [String]) {
32.         self.date = date
33.         self.dayNumber = dayNumber
34.         self.subjects = subjects
35.     }
36. }
37. 
38. 修改 Exam 模型// 在 Exam 类中添加:
39. var examGroup: ExamGroup?
40. var isGroupExam: Bool { examGroup != nil }
41. 
验收标准:
* 新模型定义完成，编译通过
* 数据库约束确保组内科目名唯一
* 考试组不支持跨学期
- [x] 任务3: 更新添加/选择考试组UI逻辑
负责人: @UI/UX设计师 描述: 在AddDataView中集成Sheet选择/添加考试组
实现步骤:
1. 修改 AddDataView 添加考试组选择
    * 在科目选择前添加考试组选择
    * 默认选项: "单科考试"
    * 使用Sheet而非Menu，便于扩展
2. 创建 ExamGroupSelectionViewstruct ExamGroupSelectionView: View {
3.     @Environment(\.modelContext) private var modelContext
4.     @Query private var examGroups: [ExamGroup]
5.     @Binding var selectedGroup: ExamGroup?
6.     @Environment(\.dismiss) private var dismiss
7. 
8. var body: some View {
9.         NavigationView {
10.             List {
11.                 // "单科考试" 选项
12.                 Button("单科考试") {
13.                     selectedGroup = nil
14.                     dismiss()
15.                 }
16. 
17.             Section("考试组") {
18.                     ForEach(examGroups) { group in
19.                         Button(group.name) {
20.                             selectedGroup = group
21.                             dismiss()
22.                         }
23.                     }
24.                 }
25. 
26.             Section {
27.                     Button("添加新考试组") {
28.                         // 显示添加考试组界面
29.                     }
30.                 }
31.             }
32.             .navigationTitle("选择考试组")
33.             .navigationBarTitleDisplayMode(.inline)
34.         }
35.     }
36. }
37. 
38. 处理大考日期显示逻辑
    * 大考(有考试组)不显示单个日期
    * 单科考试正常显示日期选择
验收标准:
* Sheet交互流畅，用户可创建/选择组
* 不使用弹窗，体验无干扰
* 大考不显示单个日期字段
- [x] 任务4: 实现自动起名机制
负责人: @程序员 描述: 为大考自动生成名称，集成到添加流程
实现步骤:
1. 创建自动起名算法func generateExamName(examGroup: ExamGroup?, subject: Subject) -> String {
2.     guard let group = examGroup else {
3.         // 单科考试保持手动输入或使用常用名称
4.         return ""
5.     }
6. 
7. // 大考自动起名: 学期+大考名+" - "+学科
8.     return "\(group.semester)\(group.name) - \(subject.name)"
9. }
10. 
11. 集成到AddDataView
    * 选择考试组后自动生成名称
    * 禁用大考的手动名称输入
    * 单科考试保持现有逻辑
验收标准:
* 大考名称自动生成准确
* 格式: "高一第一学期期中考试 - 数学"
* 与考试组集成无缝
- [ ] 任务5: 优化/替换Chart组件
负责人: @架构师 描述: 修复Chart尺寸、范围、轴值问题
实现步骤:
1. 评估现有Chart vs Apple官方代码
    * 检查 Charts/ 目录下现有实现
    * 对比 ThirdParty/Apple Inc./CreatingADataVisualizationDashboardWithSwiftCharts/
    * 决定修复还是替换
2. 修复核心问题
    * 尺寸自适应: 使用 .frame(minHeight: 200)
    * 坐标轴最大值: 基于科目总分而非历史最大值
    * 自定义显示范围支持
3. 如选择替换
    * 将Apple官方代码适配到项目结构
    * 保持现有API接口不变
验收标准:
* 图表自适应尺寸，显示完整
* 轴值合理，基于科目总分
* 编译无误，性能良好

Phase 2: 效率与体验提升 (中优先级)
目标: 分组排序、多端适配、学期概念 预计时间: 1-2天
- [ ] 任务6: 分组与排序优化
负责人: @UI/UX设计师 描述: 在时间排序中按月份/学期/考试组分组
实现步骤:
1. 修改 AnalysisView 添加分组选项enum GroupingOption: String, CaseIterable {
2.     case none = "不分组"
3.     case month = "按月份"
4.     case semester = "按学期"
5.     case examGroup = "按考试组"
6. }
7. 
8. 实现分组逻辑
    * 使用SwiftUI Section实现分组显示
    * 添加分组切换Picker
    * 支持文件夹式折叠/展开
验收标准:
* 用户可切换不同分组视图
* 分组逻辑正确，性能良好
- [ ] 任务7: 多端适配与效率工具
负责人: @程序员 描述: 横屏适配、iPad/Mac支持、批量操作
实现步骤:
1. 横屏适配
    * 修改 AddDataView 支持横屏布局
    * 使用 @Environment(\.horizontalSizeClass) 检测
    * 横屏时使用多列布局
2. iPad优化
    * 利用更大屏幕空间
    * 支持键盘快捷键
    * 优化触控体验
3. 批量操作 (未来扩展)
    * 类似Files App的多选模式
    * 隐藏TabBar，显示底部操作栏
    * 批量添加属性/标签
验收标准:
* iPad上高效输入体验
* 横屏布局合理
* 多端编译通过
- [ ] 任务8: 学期概念引入
负责人: @架构师 描述: 添加学期过滤，简化显示
实现步骤:
1. 添加 Semester 模型@Model
2. class Semester {
3.     var name: String // "高一第一学期"
4.     var startDate: Date
5.     var endDate: Date
6.     var isActive: Bool
7. 
8. init(name: String, startDate: Date, endDate: Date) {
9.         self.name = name
10.         self.startDate = startDate
11.         self.endDate = endDate
12.         self.isActive = false
13.     }
14. }
15. 
16. 关联现有模型
    * Exam, ExamGroup 关联 Semester
    * 添加学期过滤器到主要视图
17. UI集成
    * 在 ManageSubjectsView 添加学期切换器
    * 过滤显示当前学期数据
    * 省略学期前缀简化显示
验收标准:
* 学期过滤生效
* UI简洁，切换流畅

Phase 3: 未来扩展与Polish (低优先级)
目标: 搜索功能、鼓励机制、UI打磨 预计时间: 1-2天
- [ ] 任务9: 搜索Tab与导航优化
负责人: @UI/UX设计师 描述: 添加搜索Tab，参考iOS 26新规范
实现步骤:
1. 研究iOS 26搜索Tab规范
    * 查阅Apple开发者文档
    * 了解新的搜索Tab实现方式
2. 实现搜索功能
    * 创建 SearchView
    * 支持按科目、考试名称、日期搜索
    * 类似Apple Health的分类入口
3. 重构导航结构
    * 将类别入口移到搜索Tab
    * 优化信息架构
验收标准:
* 搜索功能完整准确
* 符合iOS 26设计规范
- [ ] 任务10: 鼓励机制与智能提示
负责人: @洞察官 描述: 添加学习鼓励和薄弱点分析
实现步骤:
1. 实现鼓励算法struct EncouragementEngine {
2.     static func generateMessage(for user: UserData) -> String {
3.         let weeksLeft = calculateWeeksToSemesterEnd()
4.         let weakSubjects = analyzeWeakSubjects(user.exams)
5. 
6.     return "距离学期结束还有\(weeksLeft)周，加油！你的\(weakSubjects.first?.name ?? "某科目")需要重点关注。"
7.     }
8. 
9. static func analyzeWeakSubjects(_ exams: [Exam]) -> [Subject] {
10.         // 分析算法：计算各科目平均得分率，找出低于阈值的科目
11.     }
12. }
13. 
14. UI集成
    * 在 DashboardView 显示鼓励信息
    * 添加薄弱科目提示卡片
    * 下次考试倒计时
验收标准:
* 鼓励信息准确有用
* 薄弱点分析合理
- [ ] 任务11: 其他优化与打磨
负责人: @程序员 描述: 修复小问题，UI打磨
实现步骤:
1. 修复成绩文本框问题
    * 使用 TextField 的 .keyboardType(.decimalPad)
    * 添加输入验证，防止粘贴非数字内容
2. UI打磨 (后期)
    * 优化动画效果
    * 完善无障碍支持
    * 细节优化
验收标准:
* 输入体验流畅
* 无明显Bug

开发指导原则
代码质量
* 避免技术债: 第一次就做对，不留后患
* 充分测试: 每个功能完成后立即编译测试
* 代码复用: 优先使用现有组件，必要时创建新的可复用组件
用户体验
* 效率优先: 每个操作都要快速、直观
* 无干扰: 避免弹窗，使用禁用按钮等方式提供反馈
* 数据安全: 确保用户数据不会意外丢失
技术实现
* SwiftData优先: 充分利用SwiftData的关系和查询能力
* SwiftUI原生: 使用SwiftUI的最佳实践，避免UIKit混用
* 性能考虑: 大数据量时注意查询优化和UI响应性
测试验收
* 编译测试: 每个任务完成后必须编译通过
* 功能测试: 验证核心功能正常工作
* 边界测试: 测试极端情况和错误处理

项目里程碑
* Phase 1 完成: 核心编辑功能可用，考试组逻辑完整
* Phase 2 完成: 多端适配良好，分组功能完善
* Phase 3 完成: 搜索和鼓励功能上线，产品完整度高
最终目标: 打造一个真正服务于学生的、高效的、有洞察力的学习数据分析工具。

本指南基于250803需求整理，结合AI加速开发的实际情况制定。请严格按照Phase顺序执行，确保每个阶段的质量。
