功能实现指南
250806-1

项目概述
项目名称: The Dreamer 目标用户: 中国大陆高中生，日常使用 核心目标: 通过数据分析实现学习的自由、秩序与自我掌控 开发周期: 利用AI加速，预计1-2天完成各Phase
总体架构原则
* 技术栈: SwiftUI, SwiftData, Swift Charts
* 目标SDK: iOS 26
* 架构模式: MV (Model-View)
* 代码组织: 严格按职责划分目录 (Models/, Views/, Components/, Utils/)
* 编译测试: xcodebuild -project The Dreamer.xcodeproj -scheme The Dreamer -destination platform=iOS Simulator,name=iPhone 16 Pro clean build

Phase 1: 交互修复与数据安全 (高优先级)
目标: 修复点击区域、分数错误、删除安全机制 预计时间: 1-2天

- [x] 任务1: 修复科目和考试组管理点击区域
负责人: @UI/UX设计师 描述: 解决点击空白区域无法打开的问题，扩大点击响应区域
实现步骤:
1. 检查 ManageSubjectsView 和 ExamGroupManagementView 的点击事件
    * 确认当前使用 NavigationLink 或 Button 的点击区域限制
    * 将点击事件从文字/图表部分扩展到整个列表项
2. 优化列表项布局
    * 使用 .contentShape(Rectangle()) 扩展点击区域
    * 确保整行都可点击，包括空白区域
3. 测试交互响应
    * 验证所有列表项的点击响应
    * 确保无障碍功能正常工作
验收标准:
* 任意位置点击列表项都能正常响应
* 不影响现有的拖拽和滑动操作
* 编译通过，无运行时错误

- [ ] 任务2: 修复数学考试分数错误
负责人: @程序员 描述: 解决120分变成150分的显示或存储错误
实现步骤:
1. 检查 AddDataView 的分数输入逻辑
    * 确认 TextField 的绑定值是否正确
    * 检查数据类型转换 (String to Double)
2. 验证数据存储过程
    * 检查 Exam 模型的 totalScore 赋值
    * 确认 SwiftData 存储前后数值一致性
3. 添加输入验证
    * 限制输入为数字和小数点
    * 添加最大值检查 (如不超过999)
验收标准:
* 120分输入后正确显示为120分
* 其他科目分数不受影响
* 历史数据检查无异常

- [ ] 任务3: 引入废纸篓管理方式
负责人: @架构师 描述: 参考文件App的废纸篓机制，实现软删除功能
实现步骤:
1. 设计废纸篓数据模型
    * 添加 isDeleted 字段到 Exam 和 Subject 模型
    * 添加 deletedDate 字段记录删除时间
    * 考虑添加30天自动清理机制
2. 修改删除逻辑
    * 将硬删除改为软删除 (标记isDeleted=true)
    * 在主界面默认隐藏已删除项目
    * 创建废纸篓视图显示已删除项目
3. 实现恢复功能
    * 支持从废纸篓恢复单个或多个项目
    * 添加彻底删除选项
验收标准:
* 删除操作不再直接移除数据
* 用户可在废纸篓中恢复误删项目
* 30天后自动清理废纸篓

- [x] 任务4: 创建调试操作视图
负责人: @程序员 描述: 将删除所有数据按钮移到专门的调试视图，增加安全验证
实现步骤:
1. 创建 DebugSettingsView
    * 在 SettingsView 中添加入口
    * 使用 NavigationLink 跳转到调试视图
2. 实现安全删除机制
    * 添加文本验证输入框 (如"确认删除所有数据")
    * 必须输入完整匹配文本才能执行删除
    * 添加二次确认提示
3. 迁移现有删除功能
    * 从 SettingsView 移除原有的删除按钮
    * 将所有调试相关功能集中到 DebugSettingsView
验收标准:
* 删除所有数据需要输入验证文本
* 调试功能与其他设置分离
* 防止误操作导致数据丢失

- [x] 任务5: 优化删除逻辑和安全提示
负责人: @UI/UX设计师 描述: 平衡删除操作的便捷性和安全性，针对不同场景优化
实现步骤:
1. 设计分层删除策略
    * 单个考试删除: 直接删除 + 撤销选项
    * 多个考试删除: 确认对话框
    * 科目删除: 显示该科目下所有考试数量，要求确认
2. 实现撤销机制
    * 删除后显示短暂的撤销提示条
    * 支持手势操作撤销删除
3. 科目删除警告
    * 显示"删除科目将同时删除X场考试"
    * 添加"了解后果"的确认步骤
验收标准:
* 删除操作符合用户预期
* 重要删除有明确警告
* 提供合理的撤销机制

Phase 2: 高级交互与用户体验 (中优先级)
目标: 支持系统级编辑操作，优化OnBoarding体验 预计时间: 1-2天

- [x] 任务6: 实现系统编辑操作支持
负责人: @程序员 描述: 添加三指编辑手势和两指滑动选择功能
实现步骤:
1. 实现三指编辑手势
    * 在列表视图中添加 .onDelete 支持
    * 支持系统标准的三指轻点菜单
    * 集成剪切、复制、粘贴操作
2. 添加两指滑动选择
    * 实现多选模式入口
    * 支持两指滑动选择多个项目
    * 批量操作工具栏 (删除、移动、标记)
3. 优化编辑模式UI
    * 参考iOS系统应用的编辑模式设计
    * 添加选择计数器
    * 支持全选/取消全选
验收标准:
* 支持系统标准的三指编辑手势
* 两指滑动多选操作流畅
* 编辑模式符合iOS设计规范

- [ ] 任务7: 设计并实现OnBoarding流程
负责人: @UI/UX设计师 描述: 创建首次使用引导流程，帮助用户快速上手
实现步骤:
1. 设计OnBoarding页面结构
    * 创建 3-4 个引导页面
    * 介绍核心功能: 添加考试、查看分析、管理科目
    * 添加权限说明 (如通知权限)
2. 实现引导逻辑
    * 检测首次启动 (使用 @AppStorage)
    * 创建 OnBoardingView 包含页面指示器
    * 添加跳过和完成按钮
3. 集成数据初始化
    * 引导用户添加第一个科目
    * 可选择添加示例数据
    * 完成后直接进入主界面
验收标准:
* 首次启动自动显示引导
    * 引导流程简洁明了
    * 用户可选择跳过引导

Phase 3: 细节优化与发布准备 (低优先级)
目标: 完善交互细节，准备App Store发布 预计时间: 1-2天

- [ ] 任务8: 交互细节优化
负责人: @程序员 描述: 修复所有发现的交互问题和边界情况
实现步骤:
1. 修复输入体验
    * 优化数字键盘的显示和隐藏
    * 添加输入完成按钮
    * 修复小数点输入限制
2. 完善动画过渡
    * 添加视图切换的平滑动画
    * 优化列表更新动画
    * 修复可能的动画冲突
3. 测试所有边界情况
    * 空数据状态处理
    * 网络异常处理 (虽然为本地应用)
    * 内存使用优化
验收标准:
* 所有交互流畅自然
    * 无明显UI卡顿或异常
    * 通过全面的功能测试

开发指导原则
代码质量
* 避免技术债: 第一次就做对，不留后患
* 充分测试: 每个功能完成后立即编译测试
* 代码复用: 优先使用现有组件，必要时创建新的可复用组件
用户体验
* 效率优先: 每个操作都要快速、直观
* 无干扰: 避免弹窗，使用禁用按钮等方式提供反馈
* 数据安全: 确保用户数据不会意外丢失
技术实现
* SwiftData优先: 充分利用SwiftData的关系和查询能力
* SwiftUI原生: 使用SwiftUI的最佳实践，避免UIKit混用
* 性能考虑: 大数据量时注意查询优化和UI响应性
测试验收
* 编译测试: 每个任务完成后必须编译通过
* 功能测试: 验证核心功能正常工作
* 边界测试: 测试极端情况和错误处理

项目里程碑
* Phase 1 完成: 交互修复完成，数据安全机制到位
* Phase 2 完成: 高级交互功能实现，OnBoarding上线
* Phase 3 完成: 细节优化完成，准备提交App Store
最终目标: 打造一个真正服务于学生的、高效的、有洞察力的学习数据分析工具。

本指南基于250806-1需求整理，重点解决用户反馈的交互问题和数据安全问题。